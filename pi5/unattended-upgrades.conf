# unattended-upgrades.conf — OS security patch automation for Pi 5
#
# Install:
#   sudo apt install unattended-upgrades
#   sudo cp unattended-upgrades.conf /etc/apt/apt.conf.d/50unattended-upgrades
#   sudo dpkg-reconfigure -plow unattended-upgrades    # enables 20auto-upgrades
#
# Verify:
#   sudo unattended-upgrade --dry-run --debug
#   sudo journalctl -u unattended-upgrades

Unattended-Upgrade::Allowed-Origins {
    // Raspberry Pi OS / Debian security patches only
    "${distro_id}:${distro_codename}";
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
};

// Packages to NEVER auto-upgrade (DB/Redis: need coordinated migration)
Unattended-Upgrade::Package-Blacklist {
    "postgresql*";
    "redis*";
    "nodejs";
    "npm";
};

// Remove unused kernels/dependencies after upgrades
Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";

// Do NOT automatically reboot — DevBot restart is handled by the update pipeline
Unattended-Upgrade::Automatic-Reboot "false";

// Notify by writing to syslog (Pi 5 has no MTA by default)
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";

// Run unattended-upgrades in minimal mode (less output noise)
Unattended-Upgrade::MinimalSteps "true";
