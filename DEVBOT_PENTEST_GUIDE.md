# DevBot Penetration Testing & Security Capabilities

DevBot now includes enterprise-grade penetration testing and security scanning tools powered by Kali Linux knowledge and automated scanning modules.

## üîí Overview

DevBot can perform comprehensive security assessments including:
- **Dependency Auditing** ‚Äî Detect vulnerable npm/pnpm/yarn packages
- **Secret Scanning** ‚Äî Find leaked credentials (API keys, tokens, passwords)
- **Web Security** ‚Äî HTTP security headers, TLS configuration, endpoint probing
- **Port Scanning** ‚Äî Network reconnaissance with nmap integration
- **AI Analysis** ‚Äî Claude-powered vulnerability interpretation and prioritization

## üìã Available Scan Types

### Full Scan (`full`)
Runs all security modules in parallel for complete coverage:
- Dependency vulnerabilities (npm/pnpm/yarn audit)
- Secret detection (18 credential patterns)
- Web security headers & TLS analysis
- Network port enumeration
- DNS reconnaissance

### Dependency Audit (`dependency-audit`)
Scans package managers for known vulnerabilities:
- Detects vulnerable packages with CVE references
- Severity scoring (critical, high, medium, low)
- Fix recommendations with version numbers
- Compatible with npm, pnpm, yarn

### Secret Scan (`secret-scan`)
Regex-based credential detection across codebase:
- **Stripe keys** (sk_live, pk_live)
- **AWS credentials** (AKIA...)
- **GitHub tokens** (ghp_, gho_, ghs_, github_pat_)
- **Anthropic API keys** (sk-ant-api...)
- **OpenAI keys** (sk-...)
- **Database connection strings**
- **Private keys** (BEGIN PRIVATE KEY)
- **JWT tokens**, **OAuth secrets**, and more

Automatically redacts matched secrets in reports.

### Web Security (`web-security`)
HTTP security header analysis:
- Content-Security-Policy (CSP)
- X-Frame-Options (clickjacking protection)
- Strict-Transport-Security (HSTS)
- X-Content-Type-Options (MIME sniffing)
- Referrer-Policy
- Permissions-Policy
- TLS version & cipher suite validation

### Port Scan (`port-scan`)
Network service enumeration using nmap:
- Configurable port ranges (default: common ports)
- Service version detection
- Open/closed/filtered status
- Protocol identification

## üéØ Slack Usage

### Basic Command
```
/pentest <target>
```
Runs a full security scan on the specified target.

**Example:**
```
/pentest freakme.fun
```

### Scan a Specific Type
```
/pentest <target> --type=<scan_type>
```

**Examples:**
```
/pentest freakme.fun --type=web-security
/pentest api.tolani.dev --type=dependency-audit
/pentest 192.168.1.100 --type=port-scan
```

### Include Repository Context
```
/pentest <target> --repo=owner/repo
```

When you specify a repository, DevBot will:
- Clone or use local repository for file scanning
- Automatically create GitHub issues for critical/high findings
- Include repository-specific context in AI analysis

**Example:**
```
/pentest freakme.fun --type=full --repo=Tolani-Corp/freakme.fun
```

## ÔøΩ Discord Usage

### Basic Command
```
@DevBot !pentest <target>
```
Runs a full security scan via Discord mention.

**Example:**
```
@DevBot !pentest freakme.fun
```

### Scan a Specific Type
```
@DevBot !pentest <target> --type=<scan_type>
```

**Examples:**
```
@DevBot !pentest freakme.fun --type=web-security
@DevBot !pentest api.tolani.dev --type=dependency-audit
```

**Note:** Discord integration provides shorter reports due to message length limits. Full details are logged server-side.

## üß™ CLI Testing (No Bot Required)

### Quick Demo Script
Run pentest scans directly from the command line without Slack/Discord:

```bash
# Web security scan (default)
npm run pentest freakme.fun

# Specific scan type
npm run pentest freakme.fun web-security

# Secret scan on current directory
npm run pentest . secret-scan

# Full scan with all modules
npm run pentest freakme.fun full
```

The demo script provides formatted console output with color-coded severity levels and detailed findings.

### Test MCP Server
Verify the Kali MCP server is working correctly:

```bash
npm run test:kali-mcp
```

This will:
1. Start the MCP server
2. List available tools
3. Search for "nmap" tools
4. Retrieve pentest methodology
5. Display formatted results

## ÔøΩüõ°Ô∏è Security & Authorization

### Authorization Gate
All pentest scans require explicit authorization:
- Slack commands are pre-authorized (user accepts responsibility)
- API calls MUST set `authorized: true` in options
- Scans reject internal IPs by default (localhost, 192.168.x.x, 10.x.x.x, 172.x.x.x)
- Override internal IP blocking with `ALLOW_LOCAL_SCAN=true` env var (dev only)

### Input Validation
- **All targets validated** via Zod schemas before execution
- **Shell injection protection** ‚Äî no user input passed to shell directly
- **Path traversal prevention** ‚Äî file paths sanitized
- **Repository format enforcement** ‚Äî must be `owner/repo` format

### Rate Limiting
- Inherits DevBot's Redis-based rate limiting
- Per-user scan quotas enforced via tier management
- Prevents abuse and resource exhaustion

## üìä Report Output

### Slack Block Kit Format
Pentest reports are formatted as rich Slack Block Kit messages:
- **Risk Rating** ‚Äî Visual emoji indicators (üî¥ critical, üü† high, üü° medium, üü¢ low, ‚úÖ clean)
- **Risk Score** ‚Äî Weighted calculation (0-100)
  - Critical: 25 points each
  - High: 10 points each
  - Medium: 3 points each
  - Low: 1 point each
- **Finding Summary** ‚Äî Count by severity
- **Top Recommendation** ‚Äî AI-prioritized action item
- **AI Analysis** ‚Äî Claude's security interpretation

### GitHub Issue Creation
For scans with `--repo` flag and critical/high findings:
- Auto-creates GitHub issues labeled `security`, `pentest`
- Structured markdown with:
  - Executive summary
  - Severity breakdown
  - Detailed findings (title, description, evidence, remediation, CVE references)
  - AI analysis and recommendations
  - Footer with scan metadata

## üß† AI-Powered Analysis

DevBot uses Claude Sonnet 4 to interpret raw scan results:
- **Contextual understanding** ‚Äî Knows FreakMe.fun architecture (React, Python, Convex, Stripe)
- **Prioritization** ‚Äî Ranks findings by business impact
- **Remediation guidance** ‚Äî Actionable fix recommendations
- **False positive filtering** ‚Äî Reduces noise in automated scans
- **Cross-finding correlation** ‚Äî Identifies attack chains

## üîß Technical Integration

### MCP Server
DevBot connects to the `kali-pentest` MCP server for Kali Linux knowledge:
- **45+ penetration testing tools** documented
- **13 categories** (recon, scanning, exploitation, post-exploitation, etc.)
- **OWASP Top 10** reference
- **Penetration testing methodologies**

Located at: `c:\Users\terri\Projects\freakme.fun\mcp-pentest\`

Registered in: `c:\Users\terri\Projects\DevBot\.vscode\mcp.json`

### Service Architecture
```
src/
  middleware/
    validators.ts    # Zod schemas: pentestScanSchema, scanTargetUrlSchema, etc.
  services/
    pentest-runner.ts  # Low-level tool wrappers (nmap, npm audit, secrets, etc.)
    pentest.ts         # High-level orchestration, AI analysis, reporting
  slack/
    bot.ts             # /pentest command handler
```

### Test Coverage
43 comprehensive tests in `tests/services/pentest.test.ts`:
- Validator edge cases (internal IPs, shell injection, authorization)
- Secret detection (real temp-dir fixtures, redaction verification)
- Scan orchestration (mocked tools, AI, GitHub)
- Report formatting (Block Kit structure, emoji mapping)

## üìö Example Workflows

### 1. Pre-Deployment Security Check
```
/pentest api.freakme.fun --type=full --repo=Tolani-Corp/freakme.fun
```
- Runs complete security suite
- Creates GitHub issue if vulnerabilities found
- AI analysis prioritizes fixes before deploy

### 2. Dependency Update Audit
```
/pentest freakme.fun --type=dependency-audit --repo=Tolani-Corp/freakme.fun
```
- Checks for vulnerable packages
- Lists CVEs with severity scores
- Provides upgrade commands

### 3. Leaked Secret Detection
```
/pentest . --type=secret-scan --repo=Tolani-Corp/freakme.fun
```
- Scans entire repository for hardcoded credentials
- Redacts matched values in output
- Marks all as critical for immediate rotation

### 4. Web Security Headers Audit
```
/pentest freakme.fun --type=web-security
```
- Checks CSP, HSTS, X-Frame-Options, etc.
- Validates TLS configuration
- Recommends missing headers

### 5. Network Service Discovery
```
/pentest 203.0.113.5 --type=port-scan
```
- Enumerates open ports
- Identifies services and versions
- Highlights unexpected services

## üöÄ Future Enhancements

Planned capabilities:
- [ ] Custom scan profiles (saved configurations)
- [ ] Scheduled recurring scans (cron-style)
- [ ] Webhook notifications for critical findings
- [ ] Integration with SIEM platforms
- [ ] SQL injection and XSS fuzzing modules
- [ ] Container/Docker security scanning
- [ ] Cloud infrastructure audits (AWS, GCP, Azure)
- [ ] Compliance reporting (SOC 2, ISO 27001, GDPR)

## ‚ö†Ô∏è Important Notes

1. **Authorization Required** ‚Äî Only scan targets you own or have explicit permission to test
2. **Rate Limits Apply** ‚Äî Respect service quotas and tier limits
3. **Legal Compliance** ‚Äî Unauthorized penetration testing is illegal in most jurisdictions
4. **Production Impact** ‚Äî Port scans can trigger security alerts; coordinate with ops teams
5. **False Positives** ‚Äî Always manually verify findings before taking action
6. **Secrets Handling** ‚Äî Rotate any detected credentials immediately

---

**Need help?** Use `/devbot-help` or mention `@FunBot` with your question.
